# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License.
parameters:
    packedOutputPath: null
    artifactName: null
    validateCodeSigning: false

steps:
    - task: CopyFiles@2
      displayName: 'copy package files to upload'
      inputs:
          SourceFolder: ${{ parameters.packedOutputPath }}
          Contents: |
              latest*.yml
              Accessibility?Insights?for?Android*.*
          TargetFolder: '$(System.ArtifactStagingDirectory)/${{ parameters.artifactName }}'
          CleanTargetFolder: true

    - task: securedevelopmentteam.vss-secure-development-tools.build-task-codesignvalidation.CodeSign@1
      displayName: 'code sign validation'
      condition: and(succeeded(), eq(variables['validateCodeSigning'], 'true'))
      inputs:
          Path: '$(System.ArtifactStagingDirectory)/${{ parameters.artifactName }}'

    - task: securedevelopmentteam.vss-secure-development-tools.build-task-binskim.BinSkim@3
      displayName: 'binskim'
      inputs:
          toolVersion: Latest
          InputType: Basic
          Function: analyze
          AnalyzeTarget: '$(System.ArtifactStagingDirectory)/${{ parameters.artifactName }}/Accessibility*.*'

    - task: PublishBuildArtifacts@1
      displayName: publish artifact ${{ parameters.artifactName }}
      inputs:
          pathtoPublish: '$(System.ArtifactStagingDirectory)/${{ parameters.artifactName }}'
          artifactName: ${{ parameters.artifactName }}
